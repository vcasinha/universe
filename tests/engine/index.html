<!doctype html> 
<html lang="en"> 
	<head> 
		<meta charset="UTF-8" />
	    <title>Engine</title>
		<style>
			html, body {
				margin: 0;
				padding: 0;
			}
			
			.stage{
				width: 600px;
				margin-top: 10px;
				margin-right: auto;
				margin-left: auto;
				border: 2px solid #444444;
			}
		</style>
		<!-- Libraries -->
		<script src="../lib/jquery.min.js"></script>
		<script src="../lib/jquery.binarytransport.js"></script>
		
		<!-- Game Libraries -->
		<script src="../lib/pixi.min.js"></script>
		<script src="../lib/howler.min.js"></script>
		<script src="../lib/Box2dWeb-2.1.a.3.min.js"></script>
		
		<!-- O -->
		<script src="../lib/O.js"></script>
		<script src="../lib/O.events.js"></script>
		
		<!-- Engine -->
		<script src="app/utils.js"></script>
        <script src="../../src/vector2.js"></script>
		<script src="../../src/engine.js"></script>
        <script src="../../src/vector2.js"></script>
		<script src="../../src/application.js"></script>
		<script src="../../src/context.js"></script>
		<script src="../../src/component.js"></script>
		<script src="../../src/state.js"></script>
        <script src="../../src/misc.js"></script>
		
		<!-- Stage -->
		<script src="../../src/stage/addon.js"></script>
		<script src="../../src/stage/object.js"></script>
		<script src="../../src/stage/entity.js"></script>
		<script src="../../src/stage/tilesmap.js"></script>
		<script src="../../src/stage/components/sprite.js"></script>
		<script src="../../src/stage/components/animation.js"></script>
        <script src="../../src/stage/components/physics.js"></script>
		
		<!-- Components -->
		<script src="../../src/components/renderer/pixi.js"></script>
		<script src="../../src/components/physics/box2dweb.js"></script>
		<script src="../../src/components/physics/box2dweb.body.js"></script>
		<script src="../../src/components/loader/tmx.js"></script>
		<script src="../../src/components/loader.js"></script>
		<script src="../../src/components/audio/howl.js"></script>
		<script src="../../src/components/state.js"></script>
		<script src="../../src/components/stage.js"></script>
		<script src="../../src/components/data.js"></script>
		
		<!-- Game -->
		<script src="app/main.js"></script>
		<script src="app/states/boot.js"></script>
		<script src="app/states/splash.js"></script>
		
		<!-- Game Objects -->
		<script src="app/entities/bird.js"></script>
		<script src="app/entities/world.js"></script>
	</head>
	<body>
		<div id="stage1" class="stage"></div>
		<script>
			window.onload = function(){
				var RateLimit = function(){
					this.context = {};
					this.step = 0.5;
				};

				RateLimit.prototype.message = function(name){
					var step = 1;
					args = Array.prototype.slice.call(arguments);
					var name = args.shift();

					var limiter = this.context[name];
					if(limiter === undefined){
						limiter = this.context[name] = new Date().getTime() / 1000;
					}

					var time_current =  new Date().getTime() / 1000;
					var delta = time_current - limiter;
					if(delta > 1 / this.step){
						args.unshift('ratelimit.' + name + '(' + step + 's)');
						console.log.apply(console, args);
						this.context[name] = time_current;
					}
				};
				
				RateLimit.prototype.call = function(name, callback){
					var limiter = this.context[name];
					
					if(limiter === undefined){
						limiter = this.context[name] = new Date().getTime() / 1000;
					}

					var time_current =  new Date().getTime() / 1000;
					var delta = time_current - limiter;
					if(delta > 1 / this.step){
						this.context[name] = time_current;
						callback();
					}
				};

				rateLimit = new RateLimit();
				
				var settings = {
                    element: 'stage1',
					components: {
						loader: 'component.loader',
						renderer: 'component.renderer.pixi',
						audio: 'component.audio.howl',
						stage: 'component.stage',
						state: 'component.state',
						physics: 'component.physics.box2d',
						data: 'component.data'
					},
					state:{
						states: ['boot', 'splash'],
						step: 1 / 60,
					},
					renderer: {
						width: 800,
						height: 200,
						background: 0xffffff,
						interactive: true,
						renderer: {
							antialias: true
						}
					},
					physics: {
						scale: 100,
						gravity: {
							x: 0.0,
							y: 0.5
						}
					}
				};

				window.app1 = O.instance('engine.application');
				app1.init(settings);
				app1.start();
				//app1.togglePause();
			}
		</script>
	</body>
</html>